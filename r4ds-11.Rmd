---
title: "R for Data Science"
output: 
  html_notebook:
    toc: true
---

## 11 Data Import

From R for Data Science: [11 Data Import](http://r4ds.had.co.nz/data-import.html)
Started: 1 May, 2018

### 11.1 Introduction

```{r}
library(tidyverse)
```

### 11.2 Getting Started

- `readr` functions are mostly concerned with flat files into data.frames:

|separation|function    
|:--------|:-----------|
|delimiter| |
| , comma | `read_csv()` |
| ; semi-colon | `read_csv2()`|
| tab | `read_tcv()` |
| other | `read_delim()` |
|fixed width files| |
| auto | `read_fwf()` |
| widths | `fwf_width()` |
| positions | `fwf_positions()` |
|other| |
|white space table| `read_table()` |
|log files| `read_log()` or [webreadr](https://github.com/Ironholds/webreadr)

- Focus on `?read_csv`. Use inline csv for experimentation
    - `comment = "#"` drops all lines starting with `#`
    - `skip = n` skips n lies, after comment drop (regardless of order in function)
    - `col_names = TRUE/FALSE/c(vector)`
    - `na = "."` reads any `.` in the csv as N/A values 

```{r}
read_csv(
  "# comment
  meta data
  a,b,c
  1,2,3
  4,5,6",
  skip = 1, comment = "#", col_names = c("one","two","three")
)
```
)

#### 11.2.1 Compared to Base R

- many reasons readr is better

#### 11.2.2 Exercises

1. delimiter `|`

```{r}
read_delim(
  "a|b|c\n1|2|3\n4|5|6",
  "|"
)
```

2. Common options to `read_csv()` and `read_tsv()`: EVERYTHING
    - `file`, `skip`, `comment`
    - `col_names`, `col_types`, 
    - `locale = default_locale()` controls default timezone, encoding etc.
    - `na = c("",".","NA")`, `quoted_na = TRUE`,
    - `quote`, `comment` characters used to quote strings, and mark comments,
    - `trim_ws = TRUE` removes leading and trailing whitespace
    - `skip = n` skips lines before reading data
    - `n_max`, `guess_max` maximums rows to read, rows to use to guess col type
    - `progress`
    
3. Most important options to `?read_fwf`
    - file
    - col positions generated by `fwf_positions`, `fwf_empty` etc.
    
```{r}
fwf_sample <- readr_example("fwf-sample.txt")
cat(read_lines(fwf_sample))
# You can specify column positions in several ways:
# 1. Guess based on position of empty columns
read_fwf(fwf_sample, fwf_empty(fwf_sample, col_names = c("first", "last", "state", "ssn")))
# 2. A vector of field widths
read_fwf(fwf_sample, fwf_widths(c(20, 10, 12), c("name", "state", "ssn")))
# 3. Paired vectors of start and end positions
read_fwf(fwf_sample, fwf_positions(c(1, 30), c(10, 42), c("name", "ssn")))
# 4. Named arguments with start and end positions
read_fwf(fwf_sample, fwf_cols(name = c(1, 10), ssn = c(30, 42)))
# 5. Named arguments with column widths
read_fwf(fwf_sample, fwf_cols(name = 20, state = 10, ssn = 12))
```

4. Read this: `"x,y\n1,'a,b'"` into a data frame

```{r}
read_csv(
  "x,y\n1,'a,b'",
  quote = "'")
```

5. Whats wrong with:

- `read_csv("a,b\n1,2,3\n4,5,6")`: missing col name; only keeps col 1 & 2 values
- `read_csv("a,b,c\n1,2\n1,2,3,4")`: only keeps 3 cols, inputs NA, and drops 4
- `read_csv("a,b\n\"1")`: inputs NA for missing value
- `read_csv("a,b\n1,2\na,b")`: 
- `read_csv("a;b\n1;3")`: delimiter is semi-colon, should be `read_csv2`